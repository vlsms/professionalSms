"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const constants_1 = require("./constants");
const constants_2 = require("../util/constants");
const Handler_1 = require("../services/Handler");
const helpers_1 = require("../util/helpers");
const MCULayoutEventHandler = (session, eventData) => {
    const { contentType, canvasType, callID, canvasInfo = null, currentLayerIdx = -1 } = eventData;
    if (canvasInfo && canvasType !== 'mcu-personal-canvas') {
        delete canvasInfo.memberID;
    }
    const data = {
        type: constants_1.NOTIFICATION_TYPE.conferenceUpdate,
        call: session.calls[callID],
        canvasInfo: _clearCanvasInfo(canvasInfo),
        currentLayerIdx
    };
    switch (contentType) {
        case 'layer-info': {
            const notification = Object.assign({ action: constants_1.ConferenceAction.LayerInfo }, data);
            Handler_1.trigger(constants_2.SwEvent.Notification, notification, session.uuid);
            break;
        }
        case 'layout-info': {
            const notification = Object.assign({ action: constants_1.ConferenceAction.LayoutInfo }, data);
            Handler_1.trigger(constants_2.SwEvent.Notification, notification, session.uuid);
            break;
        }
    }
};
exports.MCULayoutEventHandler = MCULayoutEventHandler;
const _clearCanvasInfo = (canvasInfo) => {
    const tmp = JSON.stringify(canvasInfo)
        .replace(/memberID/g, 'participantId')
        .replace(/ID"/g, 'Id"')
        .replace(/POS"/g, 'Pos"');
    return helpers_1.safeParseJson(tmp);
};
